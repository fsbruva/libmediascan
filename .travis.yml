language: c
os: linux
dist: xenial
arch:
  - s390x
env: Ubuntu=Xenial

compiler:
  - clang

addons:
  apt:
    update: true
    packages:
      - nasm
      - rsync
      - zlib1g-dev
      - libmodule-install-perl
      - cpanminus
# This is added only because the latest version of libexif needs it
      - autopoint
      - gettext

git:
  depth: 1

install: skip

before_script: autoreconf -fi && bash -o errexit buildme.sh -j 4
script: cd deplibs && bash -o errexit buildme-latest.sh -j 4


jobs:
  include:
  # We can't do matrix expansion across multiple OS's, because only linux has the various
  # versions of Perl built and available. Instead, we add all the various Perl/compiler
  # combinations as explicit include jobs.

    - &xenial_gcc49_alias
      arch: amd64
      os: linux
      dist: xenial
      language: c
      compiler: gcc

      addons:
        apt:
          update: true
          sources:
            - ubuntu-toolchain-r-test
          packages:
            - g++-4.9
            - nasm
            - rsync
            - zlib1g-dev
            - libmodule-install-perl
            - cpanminus
            - autopoint
            - gettext
      env: Ubuntu=Xenial && CC=gcc-4.9 && CXX=g++-4.9
